./scripts/auto_trade_market.sh at=test1 fr=EUR_USD tf=5m
test1 acount:
-----------
[5m-Market] 2026-01-13 17:54:28 - INFO - Time: 2026-01-13 17:54:28
[5m-Market] 2026-01-13 17:54:28 - INFO - OVERALL Market: BEAR | Balance: $100002.89 | P/L: $59.93
[5m-Market] 2026-01-13 17:54:28 - INFO - SCALPING: ENABLED=TRUE | Window: 20:00-10:00 PT | OUT_OF_WINDOW
[5m-Market] 2026-01-13 17:54:28 - INFO - Position: SHORT 130,279.0 units (1.303 lots) [$100 risk]
[5m-Market] 2026-01-13 17:54:28 - INFO - Expected Take Profit R:R: 0.6 | Current R:R Reached: 0.60
[5m-Market] 2026-01-13 17:54:28 - INFO - ⚠️  Approaching Take Profit Target (0.60/0.6)
[5m-Market] 2026-01-13 17:54:28 - INFO - Signal: HOLD_SHORT | Price: 1.16390
[5m-Market] 2026-01-13 17:54:28 - INFO -   Stop Loss Adjustment (SHORT): 1.16467 → 1.16517 (+5 pips buffer)
[5m-Market] 2026-01-13 17:54:39 - INFO - --------------------------------------------------------------------------------
[5m-Market] 2026-01-13 17:54:39 - INFO - Time: 2026-01-13 17:54:39
[5m-Market] 2026-01-13 17:54:39 - INFO - OVERALL Market: BEAR | Balance: $100002.89 | P/L: $59.93
[5m-Market] 2026-01-13 17:54:39 - INFO - SCALPING: ENABLED=TRUE | Window: 20:00-10:00 PT | OUT_OF_WINDOW
[5m-Market] 2026-01-13 17:54:39 - INFO - Position: SHORT 130,279.0 units (1.303 lots) [$100 risk]
[5m-Market] 2026-01-13 17:54:39 - INFO - Expected Take Profit R:R: 0.6 | Current R:R Reached: 0.60
[5m-Market] 2026-01-13 17:54:39 - INFO - ⚠️  Approaching Take Profit Target (0.60/0.6)
[5m-Market] 2026-01-13 17:54:39 - INFO - Signal: HOLD_SHORT | Price: 1.16390
[5m-Market] 2026-01-13 17:54:39 - INFO -   Stop Loss Adjustment (SHORT): 1.16467 → 1.16517 (+5 pips buffer)
[5m-Market] 2026-01-13 17:54:49 - INFO - --------------------------------------------------------------------------------
[5m-Market] 2026-01-13 17:54:49 - INFO - Time: 2026-01-13 17:54:49
[5m-Market] 2026-01-13 17:54:49 - INFO - OVERALL Market: BEAR | Balance: $100002.89 | P/L: $62.53
[5m-Market] 2026-01-13 17:54:49 - INFO - SCALPING: ENABLED=TRUE | Window: 20:00-10:00 PT | OUT_OF_WINDOW
[5m-Market] 2026-01-13 17:54:49 - INFO - Position: SHORT 130,279.0 units (1.303 lots) [$100 risk]
[5m-Market] 2026-01-13 17:54:49 - INFO - Expected Take Profit R:R: 0.6 | Current R:R Reached: 0.63
[5m-Market] 2026-01-13 17:54:49 - INFO - ⚠️  Approaching Take Profit Target (0.63/0.6)
[5m-Market] 2026-01-13 17:54:49 - INFO - Signal: HOLD_SHORT | Price: 1.16390
[5m-Market] 2026-01-13 17:54:49 - INFO -   Stop Loss Adjustment (SHORT): 1.16467 → 1.16517 (+5 pips buffer)
[5m-Market] 2026-01-13 17:55:00 - INFO - --------------------------------------------------------------------------------
[5m-Market] 2026-01-13 17:55:00 - INFO - Time: 2026-01-13 17:55:00
[5m-Market] 2026-01-13 17:55:00 - INFO - OVERALL Market: BEAR | Balance: $100002.89 | P/L: $63.84
[5m-Market] 2026-01-13 17:55:00 - INFO - SCALPING: ENABLED=TRUE | Window: 20:00-10:00 PT | OUT_OF_WINDOW
[5m-Market] 2026-01-13 17:55:00 - INFO - Position: SHORT 130,279.0 units (1.303 lots) [$100 risk]
[5m-Market] 2026-01-13 17:55:00 - INFO - Expected Take Profit R:R: 0.6 | Current R:R Reached: 0.64
[5m-Market] 2026-01-13 17:55:00 - INFO - ⚠️  Approaching Take Profit Target (0.64/0.6)
[5m-Market] 2026-01-13 17:55:00 - INFO - Signal: HOLD_SHORT | Price: 1.16390
[5m-Market] 2026-01-13 17:55:00 - INFO -   Stop Loss Adjustment (SHORT): 1.16467 → 1.16517 (+5 pips buffer)
[5m-Market] 2026-01-13 17:55:10 - INFO - --------------------------------------------------------------------------------
[5m-Market] 2026-01-13 17:55:10 - INFO - Time: 2026-01-13 17:55:10
[5m-Market] 2026-01-13 17:55:10 - INFO - OVERALL Market: BEAR | Balance: $100002.89 | P/L: $66.44
[5m-Market] 2026-01-13 17:55:10 - INFO - SCALPING: ENABLED=TRUE | Window: 20:00-10:00 PT | OUT_OF_WINDOW
[5m-Market] 2026-01-13 17:55:10 - INFO - Position: SHORT 130,279.0 units (1.303 lots) [$100 risk]
[5m-Market] 2026-01-13 17:55:10 - INFO - Expected Take Profit R:R: 0.6 | Current R:R Reached: 0.66
[5m-Market] 2026-01-13 17:55:10 - INFO - ⚠️  Approaching Take Profit Target (0.66/0.6)
[5m-Market] 2026-01-13 17:55:10 - INFO - Signal: HOLD_SHORT | Price: 1.16382
[5m-Market] 2026-01-13 17:55:10 - INFO -   Stop Loss Adjustment (SHORT): 1.16467 → 1.16517 (+5 pips buffer)
[5m-Market] 2026-01-13 17:55:21 - INFO - --------------------------------------------------------------------------------
[5m-Market] 2026-01-13 17:55:21 - INFO - Time: 2026-01-13 17:55:21
[5m-Market] 2026-01-13 17:55:21 - INFO - OVERALL Market: BEAR | Balance: $100002.89 | P/L: $66.44
[5m-Market] 2026-01-13 17:55:21 - INFO - SCALPING: ENABLED=TRUE | Window: 20:00-10:00 PT | OUT_OF_WINDOW
[5m-Market] 2026-01-13 17:55:21 - INFO - Position: SHORT 130,279.0 units (1.303 lots) [$100 risk]
[5m-Market] 2026-01-13 17:55:21 - INFO - Expected Take Profit R:R: 0.6 | Current R:R Reached: 0.66
[5m-Market] 2026-01-13 17:55:21 - INFO - ⚠️  Approaching Take Profit Target (0.66/0.6)
[5m-Market] 2026-01-13 17:55:21 - INFO - Signal: HOLD_SHORT | Price: 1.16382
[5m-Market] 2026-01-13 17:55:21 - INFO -   Stop Loss Adjustment (SHORT): 1.16467 → 1.16517 (+5 pips buffer)
[-----------
[5m-Market] 2026-01-13 17:59:36 - INFO - Time: 2026-01-13 17:59:36
[5m-Market] 2026-01-13 17:59:36 - INFO - OVERALL Market: BEAR | Balance: $100002.89 | P/L: $71.65
[5m-Market] 2026-01-13 17:59:36 - INFO - SCALPING: ENABLED=TRUE | Window: 20:00-10:00 PT | OUT_OF_WINDOW
[5m-Market] 2026-01-13 17:59:36 - INFO - Position: SHORT 130,279.0 units (1.303 lots) [$100 risk]
[5m-Market] 2026-01-13 17:59:36 - INFO - Expected Take Profit R:R: 0.6 | Current R:R Reached: 0.72
[5m-Market] 2026-01-13 17:59:36 - INFO - ⚠️  Approaching Take Profit Target (0.72/0.6)
[5m-Market] 2026-01-13 17:59:36 - INFO - Signal: HOLD_SHORT | Price: 1.16382
[5m-Market] 2026-01-13 17:59:36 - INFO -   Stop Loss Adjustment (SHORT): 1.16467 → 1.16517 (+5 pips buffer)
[5m-Market] 2026-01-13 17:59:47 - INFO - --------------------------------------------------------------------------------
[5m-Market] 2026-01-13 17:59:47 - INFO - Time: 2026-01-13 17:59:47
[5m-Market] 2026-01-13 17:59:47 - INFO - OVERALL Market: BEAR | Balance: $100002.89 | P/L: $65.14
[5m-Market] 2026-01-13 17:59:47 - INFO - SCALPING: ENABLED=TRUE | Window: 20:00-10:00 PT | OUT_OF_WINDOW
[5m-Market] 2026-01-13 17:59:47 - INFO - Position: SHORT 130,279.0 units (1.303 lots) [$100 risk]
[5m-Market] 2026-01-13 17:59:47 - INFO - Expected Take Profit R:R: 0.6 | Current R:R Reached: 0.65
[5m-Market] 2026-01-13 17:59:47 - INFO - ⚠️  Approaching Take Profit Target (0.65/0.6)
[5m-Market] 2026-01-13 17:59:47 - INFO - Signal: HOLD_SHORT | Price: 1.16382
[5m-Market] 2026-01-13 17:59:47 - INFO -   Stop Loss Adjustment (SHORT): 1.16467 → 1.16517 (+5 pips buffer)


Claude fix log:
Root Cause Analysis

  The bug was NOT the same as bug1. Bug1 was about TP not being fetched from OANDA. This bug (bug2) is a calculation inconsistency:
  ┌─────────────────┬─────────────────────────────────────────────────────┐
  │    Component    │                  Used SL Distance                   │
  ├─────────────────┼─────────────────────────────────────────────────────┤
  │ Position Sizing │ signal_price - supertrend (NO buffer) = ~7.7 pips   │
  ├─────────────────┼─────────────────────────────────────────────────────┤
  │ TP Calculation  │ signal_price - stop_loss (WITH buffer) = ~13.6 pips │
  └─────────────────┴─────────────────────────────────────────────────────┘
  This caused TP to be set ~3.5 pips too far, making the bot display R:R 0.72 while OANDA TP was still 3.6 pips away.

  Fix Applied

  Changed TP calculation in both locations (src/trading_bot_market_aware.py) to use base_stop (supertrend/pivot without buffer) instead of the buffered stop_loss:

  1. Line 1237: Initial TP calculation when placing order
  2. Line 1326: TP correction after fill

  Expected Behavior After Fix

  For test1's trade (R:R 0.6 with 7.7 pip position sizing):
  - Before: TP at 8.1 pips → R:R ~1.05 from $100 risk
  - After: TP at 4.6 pips → R:R 0.6 from $100 risk

  The bot's displayed R:R will now match OANDA's TP trigger point.

  Note: The current test1 trade has incorrect TP. You can either:
  1. Close it manually
  2. Let it run (it will eventually hit TP, just at a higher R:R than expected)
  3. Use python3 set_take_profit.py test1 rr=0.6 to manually fix the TP