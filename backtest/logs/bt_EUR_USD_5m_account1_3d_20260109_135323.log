/Users/dongchen/Documents/AI-project/GitHub/ppsupertrend/venv/lib/python3.9/site-packages/urllib3/__init__.py:35: NotOpenSSLWarning: urllib3 v2 only supports OpenSSL 1.1.1+, currently the 'ssl' module is compiled with 'LibreSSL 2.8.3'. See: https://github.com/urllib3/urllib3/issues/3020
  warnings.warn(
2026-01-09 13:53:25,555 - INFO - Downloading EUR_USD data for timeframes: ['M5', 'H3']
2026-01-09 13:53:25,555 - INFO - Downloading EUR_USD data for timeframes: ['M5', 'H3']
2026-01-09 13:53:25,555 - INFO - 
--- Downloading M5 data ---
2026-01-09 13:53:25,555 - INFO - 
--- Downloading M5 data ---
2026-01-09 13:53:25,555 - INFO - Loading cached data from backtest/data/EUR_USD_M5_20260106_20260109.csv
2026-01-09 13:53:25,555 - INFO - Loading cached data from backtest/data/EUR_USD_M5_20260106_20260109.csv
2026-01-09 13:53:25,563 - INFO - ✓ M5: 863 candles
2026-01-09 13:53:25,563 - INFO - ✓ M5: 863 candles
2026-01-09 13:53:25,563 - INFO - 
--- Downloading H3 data ---
2026-01-09 13:53:25,563 - INFO - 
--- Downloading H3 data ---
2026-01-09 13:53:25,563 - INFO - Loading cached data from backtest/data/EUR_USD_H3_20260106_20260109.csv
2026-01-09 13:53:25,563 - INFO - Loading cached data from backtest/data/EUR_USD_H3_20260106_20260109.csv
2026-01-09 13:53:25,564 - INFO - ✓ H3: 49 candles
2026-01-09 13:53:25,564 - INFO - ✓ H3: 49 candles

==================================================
DOWNLOAD SUMMARY
==================================================
M5: 863 candles (2026-01-06 21:35:00+00:00 to 2026-01-09 21:25:00+00:00)
H3: 49 candles (2025-12-31 16:00:00+00:00 to 2026-01-09 16:00:00+00:00)
/Users/dongchen/Documents/AI-project/GitHub/ppsupertrend/venv/lib/python3.9/site-packages/urllib3/__init__.py:35: NotOpenSSLWarning: urllib3 v2 only supports OpenSSL 1.1.1+, currently the 'ssl' module is compiled with 'LibreSSL 2.8.3'. See: https://github.com/urllib3/urllib3/issues/3020
  warnings.warn(
2026-01-09 13:53:25,833 - INFO - Downloading EUR_USD data for timeframes: ['M5', 'H3']
2026-01-09 13:53:25,833 - INFO - Downloading EUR_USD data for timeframes: ['M5', 'H3']
2026-01-09 13:53:25,833 - INFO - 
--- Downloading M5 data ---
2026-01-09 13:53:25,833 - INFO - 
--- Downloading M5 data ---
2026-01-09 13:53:25,833 - INFO - Loading cached data from backtest/data/EUR_USD_M5_20260106_20260109.csv
2026-01-09 13:53:25,833 - INFO - Loading cached data from backtest/data/EUR_USD_M5_20260106_20260109.csv
2026-01-09 13:53:25,838 - INFO - ✓ M5: 863 candles
2026-01-09 13:53:25,838 - INFO - ✓ M5: 863 candles
2026-01-09 13:53:25,838 - INFO - 
--- Downloading H3 data ---
2026-01-09 13:53:25,838 - INFO - 
--- Downloading H3 data ---
2026-01-09 13:53:25,838 - INFO - Loading cached data from backtest/data/EUR_USD_H3_20260106_20260109.csv
2026-01-09 13:53:25,838 - INFO - Loading cached data from backtest/data/EUR_USD_H3_20260106_20260109.csv
2026-01-09 13:53:25,839 - INFO - ✓ H3: 49 candles
2026-01-09 13:53:25,839 - INFO - ✓ H3: 49 candles
2026-01-09 13:53:25,843 - INFO - Starting backtest for EUR_USD 5m
2026-01-09 13:53:25,843 - INFO - Starting backtest for EUR_USD 5m
2026-01-09 13:53:25,843 - INFO - Trading data: 863 candles
2026-01-09 13:53:25,843 - INFO - Trading data: 863 candles
2026-01-09 13:53:25,843 - INFO - Market data: 49 candles
2026-01-09 13:53:25,843 - INFO - Market data: 49 candles
2026-01-09 13:53:25,844 - INFO - Backtest period: 2026-01-06 21:35:00+00:00 to 2026-01-09 21:25:00+00:00
2026-01-09 13:53:25,844 - INFO - Backtest period: 2026-01-06 21:35:00+00:00 to 2026-01-09 21:25:00+00:00
2026-01-09 13:53:25,844 - INFO - Calculating indicators...
2026-01-09 13:53:25,844 - INFO - Calculating indicators...
2026-01-09 13:53:26,324 - INFO - OPENED SHORT | Price: 1.16934 | SL: 1.17045 | TP: 1.16823 | Size: 90,453 | Market: NEUTRAL
2026-01-09 13:53:26,324 - INFO - OPENED SHORT | Price: 1.16934 | SL: 1.17045 | TP: 1.16823 | Size: 90,453 | Market: NEUTRAL
2026-01-09 13:53:26,331 - INFO - CLOSED SHORT | P/L: $-50.65 | Reason: SIGNAL_REVERSAL | Duration: 120m
2026-01-09 13:53:26,331 - INFO - CLOSED SHORT | P/L: $-50.65 | Reason: SIGNAL_REVERSAL | Duration: 120m
2026-01-09 13:53:26,331 - INFO - OPENED LONG | Price: 1.16990 | SL: 1.16893 | TP: 1.17087 | Size: 103,273 | Market: NEUTRAL
2026-01-09 13:53:26,331 - INFO - OPENED LONG | Price: 1.16990 | SL: 1.16893 | TP: 1.17087 | Size: 103,273 | Market: NEUTRAL
2026-01-09 13:53:26,333 - INFO - CLOSED LONG | P/L: $-100.00 | Reason: STOP_LOSS | Duration: 40m
2026-01-09 13:53:26,333 - INFO - CLOSED LONG | P/L: $-100.00 | Reason: STOP_LOSS | Duration: 40m
2026-01-09 13:53:26,333 - INFO - OPENED SHORT | Price: 1.16864 | SL: 1.17032 | TP: 1.16696 | Size: 59,584 | Market: NEUTRAL
2026-01-09 13:53:26,333 - INFO - OPENED SHORT | Price: 1.16864 | SL: 1.17032 | TP: 1.16696 | Size: 59,584 | Market: NEUTRAL
2026-01-09 13:53:26,345 - INFO - CLOSED SHORT | P/L: $-35.75 | Reason: SIGNAL_REVERSAL | Duration: 225m
2026-01-09 13:53:26,345 - INFO - CLOSED SHORT | P/L: $-35.75 | Reason: SIGNAL_REVERSAL | Duration: 225m
2026-01-09 13:53:26,345 - INFO - OPENED LONG | Price: 1.16924 | SL: 1.16752 | TP: 1.17096 | Size: 58,253 | Market: NEUTRAL
2026-01-09 13:53:26,345 - INFO - OPENED LONG | Price: 1.16924 | SL: 1.16752 | TP: 1.17096 | Size: 58,253 | Market: NEUTRAL
2026-01-09 13:53:26,369 - INFO - CLOSED LONG | P/L: $-54.76 | Reason: SIGNAL_REVERSAL | Duration: 460m
2026-01-09 13:53:26,369 - INFO - CLOSED LONG | P/L: $-54.76 | Reason: SIGNAL_REVERSAL | Duration: 460m
2026-01-09 13:53:26,369 - INFO - OPENED SHORT | Price: 1.16830 | SL: 1.16959 | TP: 1.16701 | Size: 77,605 | Market: NEUTRAL
2026-01-09 13:53:26,369 - INFO - OPENED SHORT | Price: 1.16830 | SL: 1.16959 | TP: 1.16701 | Size: 77,605 | Market: NEUTRAL
2026-01-09 13:53:26,394 - INFO - CLOSED SHORT | P/L: $24.83 | Reason: SIGNAL_REVERSAL | Duration: 465m
2026-01-09 13:53:26,394 - INFO - CLOSED SHORT | P/L: $24.83 | Reason: SIGNAL_REVERSAL | Duration: 465m
2026-01-09 13:53:26,394 - INFO - OPENED LONG | Price: 1.16798 | SL: 1.16700 | TP: 1.16896 | Size: 101,655 | Market: NEUTRAL
2026-01-09 13:53:26,394 - INFO - OPENED LONG | Price: 1.16798 | SL: 1.16700 | TP: 1.16896 | Size: 101,655 | Market: NEUTRAL
2026-01-09 13:53:26,411 - INFO - CLOSED LONG | P/L: $-59.98 | Reason: SIGNAL_REVERSAL | Duration: 335m
2026-01-09 13:53:26,411 - INFO - CLOSED LONG | P/L: $-59.98 | Reason: SIGNAL_REVERSAL | Duration: 335m
2026-01-09 13:53:26,411 - INFO - OPENED SHORT | Price: 1.16739 | SL: 1.16849 | TP: 1.16629 | Size: 91,126 | Market: NEUTRAL
2026-01-09 13:53:26,411 - INFO - OPENED SHORT | Price: 1.16739 | SL: 1.16849 | TP: 1.16629 | Size: 91,126 | Market: NEUTRAL
2026-01-09 13:53:26,428 - INFO - CLOSED SHORT | P/L: $100.00 | Reason: TAKE_PROFIT | Duration: 330m
2026-01-09 13:53:26,428 - INFO - CLOSED SHORT | P/L: $100.00 | Reason: TAKE_PROFIT | Duration: 330m
2026-01-09 13:53:26,450 - INFO - OPENED LONG | Price: 1.16532 | SL: 1.16433 | TP: 1.16631 | Size: 101,019 | Market: NEUTRAL
2026-01-09 13:53:26,450 - INFO - OPENED LONG | Price: 1.16532 | SL: 1.16433 | TP: 1.16631 | Size: 101,019 | Market: NEUTRAL
2026-01-09 13:53:26,462 - INFO - CLOSED LONG | P/L: $18.18 | Reason: SIGNAL_REVERSAL | Duration: 225m
2026-01-09 13:53:26,462 - INFO - CLOSED LONG | P/L: $18.18 | Reason: SIGNAL_REVERSAL | Duration: 225m
2026-01-09 13:53:26,462 - INFO - OPENED SHORT | Price: 1.16550 | SL: 1.16619 | TP: 1.16481 | Size: 145,017 | Market: NEUTRAL
2026-01-09 13:53:26,462 - INFO - OPENED SHORT | Price: 1.16550 | SL: 1.16619 | TP: 1.16481 | Size: 145,017 | Market: NEUTRAL
2026-01-09 13:53:26,468 - INFO - CLOSED SHORT | P/L: $100.00 | Reason: TAKE_PROFIT | Duration: 115m
2026-01-09 13:53:26,468 - INFO - CLOSED SHORT | P/L: $100.00 | Reason: TAKE_PROFIT | Duration: 115m
2026-01-09 13:53:26,471 - INFO - OPENED LONG | Price: 1.16571 | SL: 1.16440 | TP: 1.16702 | Size: 76,609 | Market: NEUTRAL
2026-01-09 13:53:26,471 - INFO - OPENED LONG | Price: 1.16571 | SL: 1.16440 | TP: 1.16702 | Size: 76,609 | Market: NEUTRAL
2026-01-09 13:53:26,480 - INFO - CLOSED LONG | P/L: $-48.26 | Reason: SIGNAL_REVERSAL | Duration: 150m
2026-01-09 13:53:26,480 - INFO - CLOSED LONG | P/L: $-48.26 | Reason: SIGNAL_REVERSAL | Duration: 150m
2026-01-09 13:53:26,480 - INFO - OPENED SHORT | Price: 1.16508 | SL: 1.16588 | TP: 1.16428 | Size: 124,959 | Market: NEUTRAL
2026-01-09 13:53:26,480 - INFO - OPENED SHORT | Price: 1.16508 | SL: 1.16588 | TP: 1.16428 | Size: 124,959 | Market: NEUTRAL
2026-01-09 13:53:26,485 - INFO - CLOSED SHORT | P/L: $100.00 | Reason: TAKE_PROFIT | Duration: 115m
2026-01-09 13:53:26,485 - INFO - CLOSED SHORT | P/L: $100.00 | Reason: TAKE_PROFIT | Duration: 115m
2026-01-09 13:53:26,504 - INFO - OPENED LONG | Price: 1.16516 | SL: 1.16378 | TP: 1.16654 | Size: 72,352 | Market: NEUTRAL
2026-01-09 13:53:26,504 - INFO - OPENED LONG | Price: 1.16516 | SL: 1.16378 | TP: 1.16654 | Size: 72,352 | Market: NEUTRAL
2026-01-09 13:53:26,507 - INFO - CLOSED LONG | P/L: $-96.95 | Reason: SIGNAL_REVERSAL | Duration: 55m
2026-01-09 13:53:26,507 - INFO - CLOSED LONG | P/L: $-96.95 | Reason: SIGNAL_REVERSAL | Duration: 55m
2026-01-09 13:53:26,507 - INFO - OPENED SHORT | Price: 1.16382 | SL: 1.16666 | TP: 1.16098 | Size: 35,243 | Market: NEUTRAL
2026-01-09 13:53:26,507 - INFO - OPENED SHORT | Price: 1.16382 | SL: 1.16666 | TP: 1.16098 | Size: 35,243 | Market: NEUTRAL
2026-01-09 13:53:26,520 - INFO - CLOSED SHORT | P/L: $0.00 | Reason: SIGNAL_REVERSAL | Duration: 250m
2026-01-09 13:53:26,520 - INFO - CLOSED SHORT | P/L: $0.00 | Reason: SIGNAL_REVERSAL | Duration: 250m
2026-01-09 13:53:26,520 - INFO - OPENED LONG | Price: 1.16382 | SL: 1.16270 | TP: 1.16494 | Size: 89,340 | Market: NEUTRAL
2026-01-09 13:53:26,520 - INFO - OPENED LONG | Price: 1.16382 | SL: 1.16270 | TP: 1.16494 | Size: 89,340 | Market: NEUTRAL
2026-01-09 13:53:26,529 - INFO - CLOSED LONG | P/L: $-33.06 | Reason: BACKTEST_END | Duration: 170m
2026-01-09 13:53:26,529 - INFO - CLOSED LONG | P/L: $-33.06 | Reason: BACKTEST_END | Duration: 170m
2026-01-09 13:53:26,529 - INFO - Backtest completed. Total trades: 14
2026-01-09 13:53:26,529 - INFO - Backtest completed. Total trades: 14
Downloading historical data...
Running backtest...

============================================================
BACKTEST RESULTS
============================================================
Instrument: EUR_USD
Period: 3 days
Total Trades: 14
Win Rate: 35.7%
Total Return: $-136.39
Return %: -2.73%
Profit Factor: 0.72
Final Balance: $4863.61
/Users/dongchen/Documents/AI-project/GitHub/ppsupertrend/venv/lib/python3.9/site-packages/urllib3/__init__.py:35: NotOpenSSLWarning: urllib3 v2 only supports OpenSSL 1.1.1+, currently the 'ssl' module is compiled with 'LibreSSL 2.8.3'. See: https://github.com/urllib3/urllib3/issues/3020
  warnings.warn(
2026-01-09 13:53:27,002 - INFO - Downloading EUR_USD data for timeframes: ['M5', 'H3']
2026-01-09 13:53:27,002 - INFO - 
--- Downloading M5 data ---
2026-01-09 13:53:27,002 - INFO - Loading cached data from backtest/data/EUR_USD_M5_20260106_20260109.csv
2026-01-09 13:53:27,007 - INFO - ✓ M5: 863 candles
2026-01-09 13:53:27,007 - INFO - 
--- Downloading H3 data ---
2026-01-09 13:53:27,007 - INFO - Loading cached data from backtest/data/EUR_USD_H3_20260106_20260109.csv
2026-01-09 13:53:27,008 - INFO - ✓ H3: 49 candles
2026-01-09 13:53:27,012 - INFO - Starting backtest for EUR_USD 5m
2026-01-09 13:53:27,012 - INFO - Trading data: 863 candles
2026-01-09 13:53:27,012 - INFO - Market data: 49 candles
2026-01-09 13:53:27,012 - INFO - Backtest period: 2026-01-06 21:35:00+00:00 to 2026-01-09 21:25:00+00:00
2026-01-09 13:53:27,012 - INFO - Calculating indicators...
2026-01-09 13:53:27,486 - INFO - OPENED SHORT | Price: 1.16934 | SL: 1.17045 | TP: 1.16823 | Size: 90,453 | Market: NEUTRAL
2026-01-09 13:53:27,493 - INFO - CLOSED SHORT | P/L: $-50.65 | Reason: SIGNAL_REVERSAL | Duration: 120m
2026-01-09 13:53:27,493 - INFO - OPENED LONG | Price: 1.16990 | SL: 1.16893 | TP: 1.17087 | Size: 103,273 | Market: NEUTRAL
2026-01-09 13:53:27,495 - INFO - CLOSED LONG | P/L: $-100.00 | Reason: STOP_LOSS | Duration: 40m
2026-01-09 13:53:27,495 - INFO - OPENED SHORT | Price: 1.16864 | SL: 1.17032 | TP: 1.16696 | Size: 59,584 | Market: NEUTRAL
2026-01-09 13:53:27,506 - INFO - CLOSED SHORT | P/L: $-35.75 | Reason: SIGNAL_REVERSAL | Duration: 225m
2026-01-09 13:53:27,506 - INFO - OPENED LONG | Price: 1.16924 | SL: 1.16752 | TP: 1.17096 | Size: 58,253 | Market: NEUTRAL
2026-01-09 13:53:27,530 - INFO - CLOSED LONG | P/L: $-54.76 | Reason: SIGNAL_REVERSAL | Duration: 460m
2026-01-09 13:53:27,531 - INFO - OPENED SHORT | Price: 1.16830 | SL: 1.16959 | TP: 1.16701 | Size: 77,605 | Market: NEUTRAL
2026-01-09 13:53:27,554 - INFO - CLOSED SHORT | P/L: $24.83 | Reason: SIGNAL_REVERSAL | Duration: 465m
2026-01-09 13:53:27,554 - INFO - OPENED LONG | Price: 1.16798 | SL: 1.16700 | TP: 1.16896 | Size: 101,655 | Market: NEUTRAL
2026-01-09 13:53:27,571 - INFO - CLOSED LONG | P/L: $-59.98 | Reason: SIGNAL_REVERSAL | Duration: 335m
2026-01-09 13:53:27,571 - INFO - OPENED SHORT | Price: 1.16739 | SL: 1.16849 | TP: 1.16629 | Size: 91,126 | Market: NEUTRAL
2026-01-09 13:53:27,588 - INFO - CLOSED SHORT | P/L: $100.00 | Reason: TAKE_PROFIT | Duration: 330m
2026-01-09 13:53:27,609 - INFO - OPENED LONG | Price: 1.16532 | SL: 1.16433 | TP: 1.16631 | Size: 101,019 | Market: NEUTRAL
2026-01-09 13:53:27,620 - INFO - CLOSED LONG | P/L: $18.18 | Reason: SIGNAL_REVERSAL | Duration: 225m
2026-01-09 13:53:27,621 - INFO - OPENED SHORT | Price: 1.16550 | SL: 1.16619 | TP: 1.16481 | Size: 145,017 | Market: NEUTRAL
2026-01-09 13:53:27,626 - INFO - CLOSED SHORT | P/L: $100.00 | Reason: TAKE_PROFIT | Duration: 115m
2026-01-09 13:53:27,630 - INFO - OPENED LONG | Price: 1.16571 | SL: 1.16440 | TP: 1.16702 | Size: 76,609 | Market: NEUTRAL
2026-01-09 13:53:27,637 - INFO - CLOSED LONG | P/L: $-48.26 | Reason: SIGNAL_REVERSAL | Duration: 150m
2026-01-09 13:53:27,637 - INFO - OPENED SHORT | Price: 1.16508 | SL: 1.16588 | TP: 1.16428 | Size: 124,959 | Market: NEUTRAL
2026-01-09 13:53:27,643 - INFO - CLOSED SHORT | P/L: $100.00 | Reason: TAKE_PROFIT | Duration: 115m
2026-01-09 13:53:27,664 - INFO - OPENED LONG | Price: 1.16516 | SL: 1.16378 | TP: 1.16654 | Size: 72,352 | Market: NEUTRAL
2026-01-09 13:53:27,667 - INFO - CLOSED LONG | P/L: $-96.95 | Reason: SIGNAL_REVERSAL | Duration: 55m
2026-01-09 13:53:27,667 - INFO - OPENED SHORT | Price: 1.16382 | SL: 1.16666 | TP: 1.16098 | Size: 35,243 | Market: NEUTRAL
2026-01-09 13:53:27,682 - INFO - CLOSED SHORT | P/L: $0.00 | Reason: SIGNAL_REVERSAL | Duration: 250m
2026-01-09 13:53:27,682 - INFO - OPENED LONG | Price: 1.16382 | SL: 1.16270 | TP: 1.16494 | Size: 89,340 | Market: NEUTRAL
2026-01-09 13:53:27,692 - INFO - CLOSED LONG | P/L: $-33.06 | Reason: BACKTEST_END | Duration: 170m
2026-01-09 13:53:27,692 - INFO - Backtest completed. Total trades: 14
/Users/dongchen/Documents/AI-project/GitHub/ppsupertrend/./backtest/src/report_generator.py:535: UserWarning: Converting to PeriodArray/Index representation will drop timezone information.
  monthly_df['month'] = monthly_df['exit_time'].dt.to_period('M')
Starting comprehensive backtest...
Instrument: EUR_USD
Timeframe: 5m
Period: 3 days

=== Downloading Data ===
Downloaded 863 M5 candles
Downloaded 49 H3 candles

=== Running Backtest ===
Backtest completed: 14 trades
Final balance: $4,863.61
Total return: -2.73%

=== Generating Reports ===
Generating comprehensive backtest reports with prefix 'bt_EUR_USD_5m_account1_3d_20260109_135323'...
✓ Generated 5 visualization plots
✓ Generated detailed CSV trades report
✓ Generated comprehensive text summary
✓ Generated machine-readable JSON report

Report generation completed. 8 files generated in backtest/results/
Files generated:
  - bt_EUR_USD_5m_account1_3d_20260109_135323_equity_curve.png
  - bt_EUR_USD_5m_account1_3d_20260109_135323_drawdown.png
  - bt_EUR_USD_5m_account1_3d_20260109_135323_pl_distribution.png
  - bt_EUR_USD_5m_account1_3d_20260109_135323_market_analysis.png
  - bt_EUR_USD_5m_account1_3d_20260109_135323_position_analysis.png
  - bt_EUR_USD_5m_account1_3d_20260109_135323_EUR_USD_5m_trades.csv
  - bt_EUR_USD_5m_account1_3d_20260109_135323_EUR_USD_5m_summary.txt
  - bt_EUR_USD_5m_account1_3d_20260109_135323_EUR_USD_5m_report.json

=== Backtest Summary ===
Instrument: EUR_USD (5m)
Period: 3 days
Total Trades: 14
Win Rate: 35.7%
Total Return: $-136.39 (-2.73%)
Profit Factor: 0.72
Traceback (most recent call last):
  File "/tmp/run_backtest_20260109_135323.py", line 70, in <module>
    print(f"Max Drawdown: {results['risk_metrics']['max_drawdown_pct']:.2f}%")
KeyError: 'risk_metrics'
