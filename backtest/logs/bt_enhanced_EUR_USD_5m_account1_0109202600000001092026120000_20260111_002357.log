/Users/dongchen/Library/Python/3.9/lib/python/site-packages/urllib3/__init__.py:35: NotOpenSSLWarning: urllib3 v2 only supports OpenSSL 1.1.1+, currently the 'ssl' module is compiled with 'LibreSSL 2.8.3'. See: https://github.com/urllib3/urllib3/issues/3020
  warnings.warn(
2026-01-11 00:23:58,312 - INFO - Downloading EUR_USD data for timeframes: ['M5', 'H3', 'M1']
2026-01-11 00:23:58,312 - INFO - Downloading EUR_USD data for timeframes: ['M5', 'H3', 'M1']
2026-01-11 00:23:58,312 - INFO - 
--- Downloading M5 data ---
2026-01-11 00:23:58,312 - INFO - 
--- Downloading M5 data ---
2026-01-11 00:23:58,312 - INFO - Downloading recent EUR_USD M5 data...
2026-01-11 00:23:58,312 - INFO - Downloading recent EUR_USD M5 data...
2026-01-11 00:23:58,312 - INFO - Requesting 5000 recent candles
2026-01-11 00:23:58,312 - INFO - Requesting 5000 recent candles
2026-01-11 00:23:59,800 - INFO - Downloaded 5000 candles from 2025-12-15 13:20:00+00:00 to 2026-01-09 21:55:00+00:00
2026-01-11 00:23:59,800 - INFO - Downloaded 5000 candles from 2025-12-15 13:20:00+00:00 to 2026-01-09 21:55:00+00:00
2026-01-11 00:23:59,824 - INFO - Data cached to backtest/data/EUR_USD_M5_20251212_20260111.csv
2026-01-11 00:23:59,824 - INFO - Data cached to backtest/data/EUR_USD_M5_20251212_20260111.csv
2026-01-11 00:23:59,824 - INFO - ‚úì M5: 5000 candles
2026-01-11 00:23:59,824 - INFO - ‚úì M5: 5000 candles
2026-01-11 00:23:59,824 - INFO - 
--- Downloading H3 data ---
2026-01-11 00:23:59,824 - INFO - 
--- Downloading H3 data ---
2026-01-11 00:23:59,824 - INFO - Downloading recent EUR_USD H3 data...
2026-01-11 00:23:59,824 - INFO - Downloading recent EUR_USD H3 data...
2026-01-11 00:23:59,824 - INFO - Requesting 240 recent candles
2026-01-11 00:23:59,824 - INFO - Requesting 240 recent candles
2026-01-11 00:24:00,072 - INFO - Downloaded 240 candles from 2025-11-26 22:00:00+00:00 to 2026-01-09 19:00:00+00:00
2026-01-11 00:24:00,072 - INFO - Downloaded 240 candles from 2025-11-26 22:00:00+00:00 to 2026-01-09 19:00:00+00:00
2026-01-11 00:24:00,074 - INFO - Data cached to backtest/data/EUR_USD_H3_20251212_20260111.csv
2026-01-11 00:24:00,074 - INFO - Data cached to backtest/data/EUR_USD_H3_20251212_20260111.csv
2026-01-11 00:24:00,074 - INFO - ‚úì H3: 240 candles
2026-01-11 00:24:00,074 - INFO - ‚úì H3: 240 candles
2026-01-11 00:24:00,074 - INFO - 
--- Downloading M1 data ---
2026-01-11 00:24:00,074 - INFO - 
--- Downloading M1 data ---
2026-01-11 00:24:00,074 - INFO - Downloading recent EUR_USD M1 data...
2026-01-11 00:24:00,074 - INFO - Downloading recent EUR_USD M1 data...
2026-01-11 00:24:00,074 - INFO - Requesting 5000 recent candles
2026-01-11 00:24:00,074 - INFO - Requesting 5000 recent candles
2026-01-11 00:24:01,249 - INFO - Downloaded 5000 candles from 2026-01-06 10:12:00+00:00 to 2026-01-09 21:59:00+00:00
2026-01-11 00:24:01,249 - INFO - Downloaded 5000 candles from 2026-01-06 10:12:00+00:00 to 2026-01-09 21:59:00+00:00
2026-01-11 00:24:01,270 - INFO - Data cached to backtest/data/EUR_USD_M1_20251212_20260111.csv
2026-01-11 00:24:01,270 - INFO - Data cached to backtest/data/EUR_USD_M1_20251212_20260111.csv
2026-01-11 00:24:01,270 - INFO - ‚úì M1: 5000 candles
2026-01-11 00:24:01,270 - INFO - ‚úì M1: 5000 candles
2026-01-11 00:24:01,275 - INFO - üéØ Starting FIXED backtest (exact live bot logic)
2026-01-11 00:24:01,275 - INFO - Period: 2026-01-09 00:00:00+00:00 to 2026-01-09 12:00:00+00:00
2026-01-11 00:24:01,276 - INFO - Filtered to 145 trading candles
2026-01-11 00:24:01,411 - INFO - 
üìç Signal at 2026-01-09 01:40:00+00:00: SELL
2026-01-11 00:24:01,411 - INFO -    Market Trend: BEAR
2026-01-11 00:24:01,411 - INFO -    Entry Price: 1.16488
2026-01-11 00:24:01,411 - INFO -    ‚úÖ Trade ALLOWED: OPEN_SHORT
2026-01-11 00:24:01,412 - INFO - Market-aware position sizing:
2026-01-11 00:24:01,412 - INFO -   Market trend: BEAR, Position: SHORT
2026-01-11 00:24:01,412 - INFO -   Risk amount: $300.00
2026-01-11 00:24:01,412 - INFO -   Position size: 287611 units (2.876 lots)
2026-01-11 00:24:01,412 - INFO -   Actual risk: $300.00
2026-01-11 00:24:01,412 - INFO -   Stop distance: 0.00104 (10.4 pips)
2026-01-11 00:24:01,417 - INFO -    üìä Max Potential: $80.53 (ratio: 0.20:1)
2026-01-11 00:24:01,417 - INFO -    ‚è∏Ô∏è  Position OPEN: TP=1.16346, SL=1.16630, Max=1.16460
2026-01-11 00:24:01,419 - INFO -    üìä Position OPENED: SHORT at 1.16488
2026-01-11 00:24:01,528 - INFO - 
üìç Signal at 2026-01-09 03:05:00+00:00: BUY
2026-01-11 00:24:01,528 - INFO -    Market Trend: BEAR
2026-01-11 00:24:01,528 - INFO -    Entry Price: 1.16571
2026-01-11 00:24:01,528 - INFO -    üîÑ Closing existing SELL position
2026-01-11 00:24:01,528 - INFO -    üíº Position CLOSED: -238.72 P&L (Reason: NEW_SIGNAL)
2026-01-11 00:24:01,528 - INFO - ‚ö†Ô∏è  Skipping LONG trade: disable_opposite_trade enabled and market trend is BEAR
2026-01-11 00:24:01,528 - INFO -    üö´ Trade FILTERED: BUY blocked by disable_opposite_trade in BEAR market
2026-01-11 00:24:01,639 - INFO - 
üìç Signal at 2026-01-09 05:35:00+00:00: SELL
2026-01-11 00:24:01,639 - INFO -    Market Trend: BEAR
2026-01-11 00:24:01,639 - INFO -    Entry Price: 1.16508
2026-01-11 00:24:01,639 - INFO -    ‚úÖ Trade ALLOWED: OPEN_SHORT
2026-01-11 00:24:01,639 - INFO - Market-aware position sizing:
2026-01-11 00:24:01,639 - INFO -   Market trend: BEAR, Position: SHORT
2026-01-11 00:24:01,639 - INFO -   Risk amount: $300.00
2026-01-11 00:24:01,639 - INFO -   Position size: 428644 units (4.286 lots)
2026-01-11 00:24:01,639 - INFO -   Actual risk: $300.00
2026-01-11 00:24:01,639 - INFO -   Stop distance: 0.00070 (7.0 pips)
2026-01-11 00:24:01,658 - INFO -    üí∞ Take Profit HIT: $460.74 profit

üéØ FIXED BACKTEST - EXACT LIVE BOT LOGIC
Account: account1
Instrument: EUR_USD
Timeframe: 5m
Period: 2026-01-09 00:00:00+00:00 to 2026-01-09 12:00:00+00:00
Initial Balance: $5,000.00

üì• Downloading data...

üîß Running FIXED backtest with exact live bot logic...

üìä FIXED BACKTEST RESULTS:
Total Allowed Trades: 2
Profitable Trades (TP Hit): 1
Win Rate (TP Hit Rate): 50.0%
Actual Profit (TP Hits): $460.74
Max Potential Profit: $672.06
Return %: +9.21%
Final Balance: $5,682.77

üìà TRADE BREAKDOWN:
  SELL trades: 2 total, 1 profitable (50.0%)

üìÑ Signal analysis saved to: EUR_USD_5m_account1_sign_ratio_profit_Jan-9_Jan-9_176.csv
Path: backtest/results/EUR_USD_5m_account1_sign_ratio_profit_Jan-9_Jan-9_176.csv
